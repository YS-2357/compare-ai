# 2025-12-03 개발 로그

- **스트리밍 UX**
  - Streamlit에서 모델별 partial/에러를 도착 순서대로 즉시 표시하도록 수정(이모지 + 소요시간 표기).
  - summary 수신 시에만 `chat_log`를 확정 저장, 사용량 헤더/요약 기반 업데이트 유지.
  - FastAPI URL 입력을 잠그고 사이드바에서 연결 상태만 확인 가능, 우회 토큰이면 제한 없이 진행.

- **프롬프트/요약 정리**
  - 질문/요약 프롬프트를 영어 지시문으로 전환하고, 응답/요약은 한국어로만 하도록 명시.
  - 요약 프롬프트/파서를 `summaries.py`로 통합하고 기존 `app/prompts/*`, `app/parsers/*` 삭제.

- **Perplexity 개선**
  - 메타데이터(`citations/search_results/sources`)에서 URL을 폭넓게 스캔해 숫자 인용([1]) 대신 링크를 추출하도록 `_extract_source` 보강.

- **기타**
  - 상태 이모지 매핑을 문자열 `"error"` 등에도 적용.
  - Upstash 필수 사용(폴백 제거) 및 `/usage` 조회 API 추가, 로그인 직후 실제 잔여 횟수를 반영하고 0회일 때 빨간 알림으로 표시.
