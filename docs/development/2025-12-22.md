# 2025-12-22 개발 기록

## 기능/품질
- 평가 프롬프트에 실제 프롬프트(질문 치환본)를 포함해 평가 기준을 일치시킴.
- 프롬프트 생성 중복 제거로 호출당 불필요한 계산 감소.
- 실패 응답은 평가 입력에서 제외하고 결과에 `score=-1`로 보강.
- JSON 예시 추가로 평가 출력 파싱 안정화.

## 파일별 작업
- `app/services/chat_graph/nodes.py`: 현재 질문을 히스토리에서 분리해 전달, 응답 메타에 출처 목록 포함, DeepSeek 호출 추가.
- `app/services/chat_graph/workflow.py`: DeepSeek 노드 추가, `llm_registry` 공통 경로 사용.
- `app/services/prompt_eval/runner.py`: DeepSeek 생성/평가 추가, 응답 메타에 출처 포함, `llm_registry` 공통 경로 사용.
- `app/services/shared/llm_registry.py`: 공통 LLM 레지스트리로 이동.
- `app/services/shared/__init__.py`: shared exports에 LLM 레지스트리 추가.
- `app/services/shared/model_aliases.py`: DeepSeek 평가 모델/라벨 추가, Groq/Cohere 평가 모델 갱신.
- `app/ui/streamlit_app.py`: DeepSeek 모델 선택/그래프, 응답 메타·출처 표시, 기본 모델 선택 로그 감소, Groq/Cohere 모델 목록 갱신.
- `app/utils/config.py`: DeepSeek 모델/베이스 URL 설정 추가, Groq/Cohere 기본값 갱신.
- `app/api/routes.py`: `response_meta` 필드 응답에 추가.
- `.env.example`: DeepSeek 환경 변수 예시 추가.
- `app/services/chat_graph/README.md`: 공통 LLM 레지스트리 경로 안내 수정.
- `app/services/prompt_eval/runner.py`: 평가 입력에 출처 포함 응답 사용(`answer_with_sources`), UI 표시는 분리 유지.
- `app/services/chat_graph/nodes.py`: 본문 출처 강제 삽입 제거.
- `app/services/shared/errors.py`: 공통 에러 헬퍼로 이동해 chat_graph/prompt_eval이 함께 사용.
- `app/utils/config.py`: OpenAI 기본 모델을 `gpt-4.1-mini`로 갱신.
- `app/ui/streamlit_app.py`: OpenAI 모델 목록/기본값 변경.
- `app/api/routes.py`, `app/api/schemas/ask.py`: 모델 예시 갱신.
- `app/services/prompt_eval/runner.py`: 모델 오버라이드 적용 및 라벨-키 매핑 추가.
- `app/api/schemas/prompt_eval.py`, `app/api/routes.py`: `model_overrides` 지원 추가.
- `app/ui/streamlit_app.py`: 프롬프트 평가 요청에 사이드바 모델 선택 전달.

## 테스트/확인
- `python3 -m py_compile` 확인: `app/services/prompt_eval/runner.py`.
